version: 2.1
jobs:
  create_and_deploy_front_end:
    docker:
    - image: amazon/aws-cli
    steps:
      - checkout
      - run:
          name: Execute bucket.yaml - Create Cloudformation Stack
          command: |
            aws cloudformation create-stack \
            --template-file file://bucket.yaml \
            --stack-name stack-create-bucket-${CIRCLE_WORKFLOW_ID:0:7} "
 # Uncomment the step below if yoou wish to upload all contents of the current directory to the S3 bucket
  # - run: aws s3 sync . s3://mybucket-${CIRCLE_WORKFLOW_ID:0:7} --delete
workflows:
  production_deployment:
    jobs:
      - creat_and_deploy_front_end
# ================================================================================

# version: 2.1
# #orbs:
#         #  welcome: circleci/welcome-oeb@0.4.1
# # orbs:
# #   ansible-ssh: orbss/ansible-ssh@0.7.4
# jobs:
#   create_infrastructure: 
#       docker:
#         - image: ubuntu:focal-20201106
#       steps:
#         # - checkout
#         - add_ssh_keys:
#             fingerprints: 
#               - "17:f5:6e:f2:3d:b0:b2:ca:0b:a2:ed:aa:31:e9:30:a2"
#         # - name: accept new ssh fingerprints                                         
#         #     shell: ssh-keyscan -H {{ item.public_ip }} >> ~/.ssh/known_hosts          
#         #     with_items: '{{ ec2.instances }}'
#         #     sed -i -e '/host_key_checking/s/True/False/' /etc/ansible/ansible.cfg
#         - run:
#             name: Update  
#             command: apt-get update -y
#         # - run:
#         #     name: Install common
#         #     command: |
#         #       apt install software-properties-common -y
#         # - run:
#         #     name: Add the repo
#         #     command: |
#         #       add-apt-repository ppa:deadsnakes/ppa
#         # - run:
#         #     name: Install python
#         #     command: apt install python3.9 -y
#         # - run:
#         #     name: Knowing the python version
#         #     command:
#         #       python3 --version
#         # - run:
#         #     name: Install Pip
#         #     command: |
#         #       apt install python3-pip -y
#         - run: |
#             apt-get install ansible -y
#         # - run: |
#         #     whereis ansible
#         #     pip3 list  | grep ansible
#         #     ansible --version
#         # apt-get install ansible -y
#         - checkout
#         - run:
#             name: Play the playbook
#             command: |
#               ansible-playbook -i inventory.txt main.yaml 
#             environment:
#               ANSIBLE_HOST_KEY_CHECKING: False
#         # - run:
#         #     name: Create Cloudformation Stack
#         #     command: |
#         #       aws cloudformation deploy \
#         #         --template-file template.yml \
#         #         --stack-name myStack \
#         #         --region us-east-1
  

# workflows:
#   my_workflow:
#     jobs:
#       - create_infrastructure
